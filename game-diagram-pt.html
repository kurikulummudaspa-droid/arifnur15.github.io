<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Game Edukasi: Diagram Tekanan–Suhu (P–T)</title>
  <style>
    :root{--bg:#f7fbff;--card:#ffffff;--accent:#0b69ff;--muted:#475569}
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;margin:0;background:var(--bg);color:#0b1b2b}
    .container{max-width:1100px;margin:20px auto;padding:18px}
    header{display:flex;align-items:flex-start;gap:16px}
    h1{margin:0;font-size:20px}
    .meta{color:var(--muted);font-size:13px}
    .layout{display:grid;grid-template-columns:1fr 360px;gap:18px;margin-top:14px}
    .card{background:var(--card);border-radius:10px;padding:14px;box-shadow:0 8px 24px rgba(8,12,30,0.06)}
    #chart{width:100%;height:520px;border-radius:8px;background:linear-gradient(180deg,#ffffff,#f0f8ff);display:flex;align-items:center;justify-content:center}
    .controls{display:flex;flex-direction:column;gap:10px}
    .row{display:flex;gap:8px;align-items:center}
    input[type=range]{width:100%}
    button.btn{background:var(--accent);color:white;padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
    .legend{display:flex;gap:10px;flex-wrap:wrap}
    .legend span{display:inline-flex;align-items:center;gap:8px;padding:6px 8px;border-radius:8px;background:#f1f7ff}
    .info{font-size:14px;color:#0f1724}
    .quiz{margin-top:10px}
    .choice{display:block;padding:8px 10px;border-radius:8px;border:1px solid #e6eefb;background:#fff;margin-bottom:6px;cursor:pointer}
    footer{margin-top:12px;color:var(--muted);font-size:13px}
    @media(max-width:1000px){.layout{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Game Edukasi: Diagram Tekanan–Suhu (P–T)</h1>
        <div class="meta">Materi: Termodinamika dasar — diagram fasa, titik tripel, titik kritis, dan kurva tekanan uap. Target: Siswa SMA / mahasiswa awal.</div>
      </div>
    </header>

    <section class="layout">
      <main class="card">
        <div id="chart">
          <!-- SVG chart injected here -->
        </div>

        <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center">
          <div class="legend" id="legend"></div>
          <div class="info">Arah panah menunjukkan perubahan fase saat tekanan/temperatur berubah.</div>
        </div>

        <div style="margin-top:12px" class="card" id="explanation" aria-live="polite">
          <strong>Penjelasan:</strong>
          <div id="explainText">Klik atau geser titik pada diagram untuk melihat fase (padat, cair, gas), titik tripel, dan titik kritis. Pilih zat pada panel kanan untuk membandingkan kurva.</div>
        </div>
      </main>

      <aside class="card controls" aria-label="Kontrol permainan">
        <div>
          <label for="substance"><strong>Pilih zat:</strong></label>
          <select id="substance" style="width:100%;padding:8px;border-radius:8px;margin-top:6px;border:1px solid #e6eefb">
            <option value="water">Air (H₂O)</option>
            <option value="ethanol">Ethanol (C₂H₅OH)</option>
            <option value="co2">Karbon dioksida (CO₂)</option>
            <option value="o2">Oksigen (O₂)</option>
          </select>
        </div>

        <div style="margin-top:10px">
          <label><strong>Mode Interaksi:</strong></label>
          <div style="margin-top:6px" class="row">
            <button class="btn" id="pointMode">Seret Titik</button>
            <button class="btn" id="resetBtn" style="background:#94a3b8">Reset</button>
          </div>
        </div>

        <div style="margin-top:12px">
          <label><strong>Parameter Kontrol (opsional)</strong></label>
          <div class="row"><div style="width:30%">Temp</div><input id="tempSlider" type="range" min="-300" max="500" value="25" /></div>
          <div class="row"><div style="width:30%">Tekanan</div><input id="pressSlider" type="range" min="0" max="200" value="1" /></div>
          <div style="font-size:13px;color:var(--muted);margin-top:6px">Satuan default: °C untuk temperatur, bar untuk tekanan (1 bar ≈ 10^5 Pa).</div>
        </div>

        <div style="margin-top:12px">
          <h4 style="margin:0 0 8px 0">Informasi Zat</h4>
          <div id="subInfo" class="info">Parameter zat dan titik penting akan ditampilkan di sini.</div>
        </div>

        <div class="quiz" id="quizArea">
          <h4 style="margin:0 0 8px 0">Kuis singkat</h4>
          <div id="quizQuestion" class="info">Siap?</div>
          <div id="quizChoices"></div>
          <div style="margin-top:8px"><button class="btn" id="nextQuiz">Soal Baru</button></div>
        </div>

      </aside>
    </section>

    <footer>
      <div class="meta">Pedagogis: Game ini ditujukan untuk memperkuat pemahaman grafik P–T (phase diagram), keterkaitan antara suhu dan tekanan, serta konsep titik tripel dan kritis. Untuk penggunaan formal, lampirkan referensi (buku teks termodinamika atau artikel review).</div>
    </footer>
  </div>

  <script>
    // Simple approximate data (arrays) for three substances: temperature (°C) vs vapor pressure (bar)
    // Data is illustrative and simplified for educational use only.
    const DATA = {
      water: {
        name: 'Air (H₂O)',
        triple: {T:0.01, P:0.0061}, // °C, bar (approx)
        critical: {T:374, P:218}, // °C, bar
        vapor: generateVaporCurve( -50, 370, t => 10**(8.07131 - 1730.63/(t+233.426)) / 1e5 ) // Antoine to Pa -> bar
      },
      ethanol: {
        name: 'Ethanol (C₂H₅OH)',
        triple: {T:-114.1, P:0.0005},
        critical: {T:241, P:63.0},
        vapor: generateVaporCurve(-100, 240, t => 10**(8.20417 - 1642.89/(t+230.3)) / 1e5)
      },
      co2: {
        name: 'Karbon dioksida (CO₂)',
        triple: {T:-56.6, P:5.11},
        critical: {T:31.0, P:73.8},
        vapor: generateVaporCurve(-80, 28, t => 10**(6.81228 - 1301.679/(t+223.0)) / 1e5)
      },
      o2: {
        name: 'Oksigen (O₂)',
        triple: {T:-218.79, P:0.00152}, // °C, bar (approx)
        critical: {T:-118.55, P:51.1}, // °C, bar (approx)
        // Vapor curve: simplified illustrative exponential model (not Antoine) for pedagogical visualization
        vapor: generateVaporCurve(-240, -119, t => Math.max(1e-8, 1e-6 * Math.exp(0.07*(t + 240))))
      }
    };

    function linspace(a,b,n){ const arr=[]; for(let i=0;i<n;i++) arr.push(a + (b-a)*i/(n-1)); return arr; }
    function generateVaporCurve(tmin,tmax,f){ const Tarray = linspace(tmin,tmax,200); return Tarray.map(t=>({T:t,P:Math.max(1e-12, f(t))})); }

    // Chart dimensions
    const chart = document.getElementById('chart');
    const svgNS = 'http://www.w3.org/2000/svg';
    const width = 820, height = 500, margin = {l:70,r:30,t:20,b:60};

    // create svg
    const svg = document.createElementNS(svgNS,'svg'); svg.setAttribute('width',width); svg.setAttribute('height',height); svg.setAttribute('viewBox',`0 0 ${width} ${height}`);
    chart.appendChild(svg);

    // scales
    function getScales(data){
      // temperature range from min T to max T for selected substance
      const allT = data.vapor.map(d=>d.T);
      const Tmin = Math.min(...allT); const Tmax = Math.max(...allT);
      const Pvals = data.vapor.map(d=>d.P).concat([data.triple.P, data.critical.P]);
      const Pmin = Math.min(...Pvals); const Pmax = Math.max(...Pvals);
      return {
        x: t=> margin.l + ((t - Tmin)/(Tmax-Tmin))*(width-margin.l-margin.r),
        xi: ()=>Tmin,
        xDomain:[Tmin,Tmax],
        y: p=> margin.t + (1 - (Math.log10(p)-Math.log10(Pmin))/(Math.log10(Pmax)-Math.log10(Pmin)))*(height-margin.t-margin.b),
        yDomain:[Pmin,Pmax]
      }
    }

    // draw axes and grid
    function drawAxes(scales){
      // clear prev axes
      Array.from(svg.querySelectorAll('.axis')).forEach(e=>e.remove());
      // x axis
      const xAxis = document.createElementNS(svgNS,'g'); xAxis.classList.add('axis');
      // ticks
      const [Tmin,Tmax] = scales.xDomain;
      for(let t=Math.ceil(Tmin/50)*50;t<=Math.ceil(Tmax/50)*50;t+=50){ const x = scales.x(t);
        const line = document.createElementNS(svgNS,'line'); line.setAttribute('x1',x); line.setAttribute('y1',height-margin.b); line.setAttribute('x2',x); line.setAttribute('y2',height-margin.b+6); line.setAttribute('stroke','#cbd5e1'); xAxis.appendChild(line);
        const txt = document.createElementNS(svgNS,'text'); txt.setAttribute('x',x); txt.setAttribute('y',height-margin.b+22); txt.setAttribute('font-size',12); txt.setAttribute('text-anchor','middle'); txt.textContent = t + ' °C'; xAxis.appendChild(txt);
      }
      // x label
      const xl = document.createElementNS(svgNS,'text'); xl.setAttribute('x',width/2); xl.setAttribute('y',height-10); xl.setAttribute('font-size',13); xl.setAttribute('text-anchor','middle'); xl.textContent='Temperatur (°C)'; xAxis.appendChild(xl);
      svg.appendChild(xAxis);

      // y axis (log scale ticks)
      const yAxis = document.createElementNS(svgNS,'g'); yAxis.classList.add('axis');
      const [Pmin,Pmax] = scales.yDomain;
      const decades = Math.floor(Math.log10(Pmin)); const decadesMax = Math.ceil(Math.log10(Pmax));
      for(let d=decades; d<=decadesMax; d++){
        for(let m=1;m<=9;m*=10){ const p = m * Math.pow(10,d);
          if(p < Pmin || p> Pmax) continue; const y = scales.y(p);
          const line = document.createElementNS(svgNS,'line'); line.setAttribute('x1',margin.l-6); line.setAttribute('y1',y); line.setAttribute('x2',width-margin.r); line.setAttribute('y2',y); line.setAttribute('stroke','#f1f5f9'); line.setAttribute('stroke-dasharray','2 2'); yAxis.appendChild(line);
          const txt = document.createElementNS(svgNS,'text'); txt.setAttribute('x',margin.l-40); txt.setAttribute('y',y+4); txt.setAttribute('font-size',11); txt.setAttribute('text-anchor','end'); txt.textContent = p.toExponential(1) + ' bar'; yAxis.appendChild(txt);
        }
      }
      const yl = document.createElementNS(svgNS,'text'); yl.setAttribute('x',14); yl.setAttribute('y',height/2); yl.setAttribute('transform',`rotate(-90 14 ${height/2})`); yl.setAttribute('font-size',13); yl.setAttribute('text-anchor','middle'); yl.textContent='Tekanan (bar)'; yAxis.appendChild(yl);
      svg.appendChild(yAxis);
    }

    // draw vapor curve
    function drawVaporCurve(data,scales,opts={color:'#0b69ff',label:'Kurva tekanan uap'}){
      // path
      const path = document.createElementNS(svgNS,'path'); path.setAttribute('fill','none'); path.setAttribute('stroke',opts.color); path.setAttribute('stroke-width','2.5'); path.setAttribute('class','vapor');
      const d = data.vapor.map((pt,i)=> `${i===0?'M':'L'} ${scales.x(pt.T)} ${scales.y(pt.P)}`).join(' ');
      path.setAttribute('d',d);
      svg.appendChild(path);
      // label near middle
      const mid = data.vapor[Math.floor(data.vapor.length*0.7)];
      const txt = document.createElementNS(svgNS,'text'); txt.setAttribute('x',scales.x(mid.T)+8); txt.setAttribute('y',scales.y(mid.P)-8); txt.setAttribute('font-size',12); txt.setAttribute('fill',opts.color); txt.textContent = opts.label; svg.appendChild(txt);
    }

    // draw triple & critical
    function drawMarkers(data,scales){
      // triple
      const tri = document.createElementNS(svgNS,'circle'); tri.setAttribute('cx',scales.x(data.triple.T)); tri.setAttribute('cy',scales.y(data.triple.P)); tri.setAttribute('r',5); tri.setAttribute('fill','#ff6b6b'); svg.appendChild(tri);
      const triTxt = document.createElementNS(svgNS,'text'); triTxt.setAttribute('x',scales.x(data.triple.T)+10); triTxt.setAttribute('y',scales.y(data.triple.P)+4); triTxt.setAttribute('font-size',12); triTxt.textContent='Titik tripel'; svg.appendChild(triTxt);
      // critical
      const crit = document.createElementNS(svgNS,'circle'); crit.setAttribute('cx',scales.x(data.critical.T)); crit.setAttribute('cy',scales.y(data.critical.P)); crit.setAttribute('r',5); crit.setAttribute('fill','#ffa500'); svg.appendChild(crit);
      const critTxt = document.createElementNS(svgNS,'text'); critTxt.setAttribute('x',scales.x(data.critical.T)+10); critTxt.setAttribute('y',scales.y(data.critical.P)+4); critTxt.setAttribute('font-size',12); critTxt.textContent='Titik kritis'; svg.appendChild(critTxt);
    }

    // interactive point
    let interactivePoint = null; let currentData = DATA.water; let scales = null;

    function render(){
      // clear svg except axes removal handled in drawAxes
      Array.from(svg.children).forEach(c=>c.remove());
      scales = getScales(currentData);
      drawAxes(scales);
      drawVaporCurve(currentData,scales,{color:'#0b69ff',label:currentData.name});
      drawMarkers(currentData,scales);
      drawPhaseRegions(currentData,scales);
      createInteractivePoint(scales);
      updateLegend(); updateSubInfo();
    }

    function drawPhaseRegions(data,scales){
      // approximate regions: left of vapor curve and above melting approximation = solid; between vapor curve and left melting = liquid; right/up is gas. For simplicity, fill three polygonal regions.
      // Build approximate boundary using vapor curve points
      const pts = data.vapor.map(p=> [scales.x(p.T), scales.y(p.P)]);
      const left = margin.l; const bottom = height - margin.b;
      // gas region (right/lower area)
      const gasPath = document.createElementNS(svgNS,'path'); gasPath.setAttribute('d', `M ${pts[pts.length-1][0]} ${pts[pts.length-1][1]} ` + pts.slice(pts.length-30).map(p=>`L ${p[0]} ${p[1]}`).join(' ') + ` L ${width-margin.r} ${height-margin.b} L ${pts[pts.length-1][0]} ${pts[pts.length-1][1]}`);
      gasPath.setAttribute('fill','rgba(3,201,255,0.04)'); gasPath.setAttribute('stroke','none'); svg.appendChild(gasPath);
      // liquid region (between curve and left)
      const liquidPath = document.createElementNS(svgNS,'path'); const topLeftY = scales.y(Math.max(currentData.triple.P*0.8,1e-6)); liquidPath.setAttribute('d', `M ${pts[0][0]} ${pts[0][1]} ` + pts.map(p=>`L ${p[0]} ${p[1]}`).join(' ') + ` L ${left} ${bottom} L ${left} ${topLeftY} Z`);
      liquidPath.setAttribute('fill','rgba(11,105,255,0.04)'); liquidPath.setAttribute('stroke','none'); svg.appendChild(liquidPath);
      // solid region (left/top)
      const solidPath = document.createElementNS(svgNS,'path'); solidPath.setAttribute('d', `M ${left} ${topLeftY} L ${pts[0][0]} ${pts[0][1]} L ${pts[0][0]} ${margin.t} L ${left} ${margin.t} Z`); solidPath.setAttribute('fill','rgba(255,107,107,0.03)'); solidPath.setAttribute('stroke','none'); svg.appendChild(solidPath);
    }

    function createInteractivePoint(scales){
      // start at ambient (25°C, 1 bar) clamp to domain
      const Tstart = Math.max(Math.min(25, scales.xDomain ? scales.xDomain[1] : 25), scales.xDomain ? scales.xDomain[0] : 25);
      const Pstart = Math.max(Math.min(1, scales.yDomain ? scales.yDomain[1] : 1), scales.yDomain ? scales.yDomain[0] : 1);
      const cx = scales.x(Tstart), cy = scales.y(Pstart);
      interactivePoint = document.createElementNS(svgNS,'circle'); interactivePoint.setAttribute('cx',cx); interactivePoint.setAttribute('cy',cy); interactivePoint.setAttribute('r',7); interactivePoint.setAttribute('fill','#ff6b6b'); interactivePoint.setAttribute('cursor','move'); interactivePoint.setAttribute('id','interactivePoint'); svg.appendChild(interactivePoint);
      // labels
      const lab = document.createElementNS(svgNS,'text'); lab.setAttribute('x',cx+12); lab.setAttribute('y',cy-12); lab.setAttribute('id','ptLabel'); lab.setAttribute('font-size',12); lab.textContent = `T=${Tstart.toFixed(1)}°C, P=${Pstart.toFixed(3)} bar`;
      svg.appendChild(lab);

      // update sliders
      document.getElementById('tempSlider').value = Tstart; document.getElementById('pressSlider').value = Pstart;

      // drag behaviour
      let dragging=false;
      interactivePoint.addEventListener('mousedown',()=> dragging=true);
      window.addEventListener('mouseup',()=> dragging=false);
      window.addEventListener('mousemove',(e)=>{ if(!dragging) return; // get mouse pos relative to svg
        const pt = svg.createSVGPoint(); pt.x = e.clientX; pt.y = e.clientY; const ctm = svg.getScreenCTM().inverse(); const loc = pt.matrixTransform(ctm);
        // clamp
        const x = Math.max(margin.l, Math.min(width-margin.r, loc.x)); const y = Math.max(margin.t, Math.min(height-margin.b, loc.y));
        interactivePoint.setAttribute('cx',x); interactivePoint.setAttribute('cy',y);
        // invert scales
        const T = invertX(x,scales); const P = invertY(y,scales);
        lab.setAttribute('x',x+12); lab.setAttribute('y',y-12);
        lab.textContent = `T=${T.toFixed(2)}°C, P=${P.toExponential(2)} bar`;
        document.getElementById('tempSlider').value = T; document.getElementById('pressSlider').value = P;
        updateExplain(T,P);
      });

      // click to set point
      svg.addEventListener('click',(e)=>{
        // avoid when clicking on interactivePoint
        if(e.target && e.target.id==='interactivePoint') return;
        const pt = svg.createSVGPoint(); pt.x = e.clientX; pt.y = e.clientY; const ctm = svg.getScreenCTM().inverse(); const loc = pt.matrixTransform(ctm);
        const x = Math.max(margin.l, Math.min(width-margin.r, loc.x)); const y = Math.max(margin.t, Math.min(height-margin.b, loc.y));
        interactivePoint.setAttribute('cx',x); interactivePoint.setAttribute('cy',y);
        const T = invertX(x,scales); const P = invertY(y,scales);
        lab.setAttribute('x',x+12); lab.setAttribute('y',y-12); lab.textContent = `T=${T.toFixed(2)}°C, P=${P.toExponential(2)} bar`;
        document.getElementById('tempSlider').value = T; document.getElementById('pressSlider').value = P;
        updateExplain(T,P);
      });

    }

    function invertX(x,scales){ const [Tmin,Tmax] = scales.xDomain; return Tmin + ( (x - margin.l) / (width-margin.l-margin.r) ) * (Tmax - Tmin); }
    function invertY(y,scales){ const [Pmin,Pmax] = scales.yDomain; const ratio = 1 - ((y - margin.t) / (height-margin.t-margin.b)); return Math.pow(10, Math.log10(Pmin) + ratio*(Math.log10(Pmax)-Math.log10(Pmin))); }

    function updateExplain(T,P){ const phase = determinePhase(T,P,currentData);
      document.getElementById('explainText').textContent = `Pada T=${T.toFixed(2)} °C dan P=${P.toExponential(3)} bar, fasanya diperkirakan: ${phase}. Titik tripel: T=${currentData.triple.T}°C, P=${currentData.triple.P} bar. Titik kritis: T=${currentData.critical.T}°C, P=${currentData.critical.P} bar.`;
    }

    function determinePhase(T,P,data){ // naive approximation: compare P to vapor pressure at T
      // find closest vapor pressure in data.vapor
      const arr = data.vapor; let closest = arr[0]; for(let i=0;i<arr.length;i++){ if(Math.abs(arr[i].T - T) < Math.abs(closest.T - T)) closest = arr[i]; }
      const Pvap = closest.P; if(P > Pvap*1.2) return 'Padat atau cair (tergantung garis lebur) — tekanan lebih tinggi dari tekanan uap'; if(P < Pvap*0.8) return 'Gas (uap)'; return 'Seimbang/Transisi (mendekati tekanan uap)'; }

    function updateLegend(){ const legend = document.getElementById('legend'); legend.innerHTML = ''; const s = document.createElement('span'); s.innerHTML = `<strong>${currentData.name}</strong>`; legend.appendChild(s); }

    function updateSubInfo(){ document.getElementById('subInfo').innerHTML = `<strong>${currentData.name}</strong><br/>Titik tripel: ${currentData.triple.T} °C, ${currentData.triple.P} bar<br/>Titik kritis: ${currentData.critical.T} °C, ${currentData.critical.P} bar`; }

    // sliders interaction
    document.getElementById('tempSlider').addEventListener('input',(e)=>{ const T = parseFloat(e.target.value); const P = parseFloat(document.getElementById('pressSlider').value); placePointAt(T,P); });
    document.getElementById('pressSlider').addEventListener('input',(e)=>{ const P = parseFloat(e.target.value); const T = parseFloat(document.getElementById('tempSlider').value); placePointAt(T,P); });

    function placePointAt(T,P){ // clamp based on domain
      if(!scales) return; const [Tmin,Tmax] = scales.xDomain; const [Pmin,Pmax] = scales.yDomain; const Tc = Math.max(Tmin, Math.min(Tmax, T)); const Pc = Math.max(Pmin, Math.min(Pmax, P)); const x = scales.x(Tc); const y = scales.y(Pc); const pt = svg.getElementById('interactivePoint'); if(pt){ pt.setAttribute('cx',x); pt.setAttribute('cy',y); const lab = svg.getElementById('ptLabel'); lab.setAttribute('x',x+12); lab.setAttribute('y',y-12); lab.textContent = `T=${Tc.toFixed(2)}°C, P=${Pc.toExponential(2)} bar`; updateExplain(Tc,Pc);} }

    // change substance
    document.getElementById('substance').addEventListener('change',(e)=>{ currentData = DATA[e.target.value]; render(); });
    document.getElementById('resetBtn').addEventListener('click',()=>{ render(); });

    // quiz simple
    const QUIZ = [
      {q:'Apa yang terjadi jika tekanan ditekan sangat rendah pada suhu > titik kritis?', choices:['Padat','Gas','Cair','Tidak berfase jelas'], ans:1},
      {q:'Titik tripel adalah kondisi di mana?', choices:['Hanya padat dan cair','Hanya cair dan gas','Ketiga fase koeksis','Tidak ada fase'], ans:2},
      {q:'Titik kritis berhubungan dengan?', choices:['Pemisahan fase padat-cair','Batas di mana gas dan cair tidak dapat dibedakan','Titk dimana tekanan = 0','Titik untuk reaksi kimia'], ans:1}
    ];
    let quizIndex = 0;
    document.getElementById('nextQuiz').addEventListener('click',()=>{ loadQuiz(); });

    function loadQuiz(){ const q = QUIZ[quizIndex % QUIZ.length]; document.getElementById('quizQuestion').textContent = q.q; const area = document.getElementById('quizChoices'); area.innerHTML = ''; q.choices.forEach((c,i)=>{ const btn = document.createElement('button'); btn.className='choice'; btn.textContent = c; btn.addEventListener('click',()=>{ if(i===q.ans){ alert('Benar!'); } else alert('Salah — coba lagi.'); quizIndex++; }); area.appendChild(btn); }); }

    // init
    render();</script>
</body>
</html>